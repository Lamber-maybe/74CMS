(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-6f044e99"],{"012c":function(t,e,i){t.exports=i.p+"static/img/02.7debd35f.png"},"0ccb":function(t,e,i){var s=i("50c4"),n=i("1148"),a=i("1d80"),o=Math.ceil,r=function(t){return function(e,i,r){var l,c,u=String(a(e)),p=u.length,d=void 0===r?" ":String(r),h=s(i);return h<=p||""==d?u:(l=h-p,c=n.call(d,o(l/d.length)),c.length>l&&(c=c.slice(0,l)),t?u+c:c+u)}};t.exports={start:r(!1),end:r(!0)}},"4d90":function(t,e,i){"use strict";var s=i("23e7"),n=i("0ccb").start,a=i("9a0c");s({target:"String",proto:!0,forced:a},{padStart:function(t){return n(this,t,arguments.length>1?arguments[1]:void 0)}})},5378:function(t,e,i){},"53ca":function(t,e,i){"use strict";i.d(e,"a",(function(){return s}));i("a4d3"),i("e01a"),i("d28b"),i("d3b7"),i("3ca3"),i("ddb0");function s(t){return s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},s(t)}},"84f2":function(t,e,i){t.exports=i.p+"static/img/04.f78b0390.png"},"9a0c":function(t,e,i){var s=i("342f");t.exports=/Version\/10\.\d+(\.\d+)?( Mobile\/\w+)? Safari\//.test(s)},"9c9e":function(t,e,i){"use strict";i.r(e);var s=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"app-container"},[s("el-card",{staticClass:"box-card"},[s("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[s("span",[t._v("系统升级")])]),s("div",{staticClass:"upgrade-tip"},[s("b",[t._v("更新注意事项：")]),s("p",[t._v("1.本次更新不会删除您的用户数据，但仍然建议您在更新前做好备份。")]),s("p",[t._v("2.如当前版本太低，需要按顺序从低到高逐步升级。")]),s("p",[t._v("3.更新完成后，请及时"),s("b",[t._v("更新缓存")]),t._v("。")]),s("p",[t._v("4.授权用户可以联系官方售后客服协助升级，如果您在升级过程中遇到任何问题，请及时联系您的专属客服。")]),s("img",{staticClass:"img",attrs:{src:i("012c")}})]),s("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.listLoading,expression:"listLoading"}],attrs:{data:t.list,"element-loading-text":"Loading",fit:""}},[s("el-table-column",{attrs:{label:"","min-width":"380"},scopedSlots:t._u([{key:"default",fn:function(e){return[s("span",{staticClass:"row-title"},[t._v(t._s(e.row.title))])]}}])}),s("el-table-column",{attrs:{label:"","min-width":"130"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(" 最新版本："),s("span",{staticStyle:{color:"#ff6600"}},[t._v("v"+t._s(t.latest_version))])]}}])}),s("el-table-column",{attrs:{label:"",prop:"size_show","min-width":"100"}}),s("el-table-column",{attrs:{label:"","min-width":"200"},scopedSlots:t._u([{key:"default",fn:function(e){return[s("span",[t._v("发布时间："+t._s(t._f("timeFilter")(e.row.addtime)))])]}}])}),s("el-table-column",{attrs:{fixed:"right",label:"","min-width":"180"},scopedSlots:t._u([{key:"default",fn:function(e){return[1==e.row.enable?s("el-button",{attrs:{size:"small",type:"primary"},on:{click:function(i){return t.openDialog(e.row)}}},[t._v(" 升级 ")]):s("el-button",{attrs:{size:"small",type:"info",disabled:""}},[t._v(" 升级 ")]),s("el-button",{attrs:{size:"small"},on:{click:function(i){return t.openLogDialog(e.row)}}},[t._v(" 更新日志 ")])]}}])})],1)],1),t.showDialog?s("el-dialog",{attrs:{title:t.title,width:"600px",visible:t.showDialog,"destroy-on-close":!0,"close-on-click-modal":!1,"close-on-press-escape":!1,"show-close":!1},on:{"update:visible":function(e){t.showDialog=e}}},[s("div",{staticClass:"upgrade-box"},[1==t.step?s("div",{staticClass:"pre-notice"},[s("div",{staticClass:"txt"},[t._v(" 1. 升级不可逆，为保证数据安全性，您在升级前请完成相应备份。未备份将无法还原，如因此导致的问题，我们不承担任何责任！"),s("br"),t._v(" 2. 升级过程中，请勿关闭升级页面，否则可能造成升级失败或其他未知问题！"),s("br"),t._v(" 3. 授权用户可以联系官方售后客服协助升级。 ")]),s("el-button",{attrs:{type:"primary",disabled:t.startDisable},on:{click:t.updateStart}},[t._v(" 我已备份，开始升级"+t._s(t.secondText)+" ")]),s("br"),s("el-button",{staticStyle:{"margin-top":"10px"},attrs:{type:"text"},on:{click:t.closeDialog}},[t._v(" 取消升级 ")])],1):t._e(),1!=t.step?s("div",[s("img",{staticClass:"top-bg",attrs:{src:i("84f2")}}),3!=t.step?s("div",{staticClass:"notice"},[t._v("正在为您升级更新，不要关闭界面")]):s("div",{staticClass:"notice done"},[t._v("升级成功")]),s("el-progress",{attrs:{"stroke-width":20,"text-inside":"",percentage:t.percentage}}),s("div",{staticClass:"progress-tip"},[t._v(t._s(t.progress_text))]),2==t.step?s("el-button",{staticClass:"btn",attrs:{type:"primary"}},[t._v(" 升级中 "),s("div",{staticClass:"loader"},[s("div",{staticClass:"loader-inner ball-pulse"},[s("div"),s("div"),s("div")])])]):s("el-button",{staticClass:"btn",attrs:{type:"primary"},on:{click:t.clearCache}},[t._v(" 清除缓存 ")])],1):t._e()])]):t._e(),t.showLogDialog?s("el-dialog",{attrs:{title:"更新日志",width:"600px",visible:t.showLogDialog,"destroy-on-close":!0,"close-on-click-modal":!1,"close-on-press-escape":!1},on:{"update:visible":function(e){t.showLogDialog=e}}},[s("div",{staticStyle:{"white-space":"pre-wrap","line-height":"36px","max-height":"500px","overflow-y":"auto"}},[t._v(t._s(t.logContent))])]):t._e()],1)},n=[],a=i("b775"),o=i("d722");function r(t){return Object(a["a"])({url:o["a"].newVersionList,method:"get",params:t})}function l(t){return Object(a["a"])({url:o["a"].updateStart,method:"get",params:t})}function c(t){return Object(a["a"])({url:o["a"].updateDownload,method:"get",params:t})}function u(t){return Object(a["a"])({url:o["a"].speedProgress,method:"get",params:t})}function p(t){return Object(a["a"])({url:o["a"].upgradeUnzip,method:"get",params:t})}function d(t){return Object(a["a"])({url:o["a"].upgradeUpdate,method:"get",params:t})}var h=i("1063"),f=i("ed08"),g={filters:{timeFilter:function(t){return Object(f["b"])(t,"{y}-{m}-{d}")}},data:function(){return{nextVersion:"",title:"升级提示",startDisable:!0,timer:"",timer_progress:"",second:10,secondText:"（10s）",step:1,percentage:20,waiting:!1,waitingText:"升级中",showDialog:!1,list:null,listLoading:!0,latest_version:"",filePath:"",size:0,timestamp:"",progress_text:"正在下载升级文件中，请稍等...",showLogDialog:!1,logContent:"",stop:0}},created:function(){this.fetchData()},methods:{openLogDialog:function(t){this.logContent=t.content2,this.showLogDialog=!0},clearCache:function(){var t=this;Object(h["a"])({}).then((function(e){200==e.code&&(t.$store.dispatch("config/getConfigInfo"),window.location.reload())}))},getSecond:function(){this.second>1?(this.second--,this.secondText="（".concat(this.second,"s）")):(this.secondText="",this.startDisable=!1,clearInterval(this.timer))},openDialog:function(t){if("all"!=localStorage.getItem("qscms_access"))return this.$alert("只有超级管理员才能执行系统升级操作！","系统提示",{confirmButtonText:"确定",type:"warning"}),!1;this.stop=0,this.size=t.size,this.title="升级提示",this.progress_text="正在下载升级文件中，请稍等...",this.startDisable=!0,this.second=10,this.secondText="（10s）",this.step=1,this.percentage=0,this.showDialog=!0,this.nextVersion=t.version_text,this.timer=setInterval(this.getSecond,1e3)},closeDialog:function(){this.showDialog=!1,clearInterval(this.timer)},updateStart:function(){var t=this,e=window.location.host,i={domain:e};l(i).then((function(e){t.step=2,t.filePath=e.data.path,t.timestamp=e.data.timestamp,t.updateDownload(),t.speedProgress()}))},updateDownload:function(){var t=this,e={path:this.filePath,timestamp:this.timestamp};c(e).then((function(e){500==e.data&&(t.stop=1,t.$alert(e.message,"系统提示",{confirmButtonText:"关闭",type:"warning",callback:function(e){t.closeDialog()}}))}))},speedProgress:function(){var t=this;if(console.log(this.stop),1==this.stop)return!1;var e=this,i={path:this.filePath,size:this.size,timestamp:this.timestamp};u(i).then((function(i){t.percentage=parseInt(i.data),t.percentage<80?setTimeout((function(){e.speedProgress()}),500):(t.progress_text="正在解压...",t.unzip())}))},unzip:function(){var t=this,e={path:this.filePath,timestamp:this.timestamp};p(e).then((function(e){t.percentage=90,t.progress_text="解压完成，正在执行升级...",t.update()}))},update:function(){var t=this,e={path:this.filePath,timestamp:this.timestamp};d(e).then((function(e){t.percentage=100,t.progress_text="您已成功升级到V"+t.nextVersion,t.step=3}))},fetchData:function(){var t=this;this.listLoading=!0;var e={};r(e).then((function(e){t.list=e.data.items,t.listLoading=!1,t.latest_version=e.data.latest_version}))}}},m=g,v=(i("bf87"),i("2877")),b=Object(v["a"])(m,s,n,!1,null,"2050f835",null);e["default"]=b.exports},bf87:function(t,e,i){"use strict";var s=i("5378"),n=i.n(s);n.a},ed08:function(t,e,i){"use strict";i.d(e,"b",(function(){return o})),i.d(e,"a",(function(){return r})),i.d(e,"c",(function(){return l}));i("d3b7"),i("ac1f"),i("25f0"),i("4d90"),i("5319"),i("1276");var s=i("53ca"),n=i("a78e"),a=i.n(n);function o(t,e){if(0===arguments.length)return null;var i,n=e||"{y}-{m}-{d} {h}:{i}:{s}";"object"===Object(s["a"])(t)?i=t:("string"===typeof t&&/^[0-9]+$/.test(t)&&(t=parseInt(t)),"number"===typeof t&&t.toString().length<=10&&(t*=1e3),i=new Date(t));var a={y:i.getFullYear(),m:i.getMonth()+1,d:i.getDate(),h:i.getHours(),i:i.getMinutes(),s:i.getSeconds(),a:i.getDay()},o=n.replace(/{([ymdhisa])+}/g,(function(t,e){var i=a[e];return"a"===e?["日","一","二","三","四","五","六"][i]:i.toString().padStart(2,"0")}));return o}function r(t,e){t=(""+t).length<=10?1e3*parseInt(t):+t;var i=new Date(t),s=Date.now(),n=(s-i)/1e3;return n<30?"刚刚":n<3600?Math.ceil(n/60)+"分钟前":n<86400?Math.ceil(n/3600)+"小时前":n<172800?"1天前":e?o(t,e):i.getMonth()+1+"月"+i.getDate()+"日"+i.getHours()+"时"+i.getMinutes()+"分"}function l(t){var e={utype:t.utype,token:t.token,mobile:t.mobile,userIminfo:t.user_iminfo};a.a.set("qscms_visitor",JSON.stringify(e),{expires:7})}}}]);